# 컨텍스트 스위칭(Context Switching)의 비용

## 1. 컨텍스트 스위칭이란?

컨텍스트 스위칭은 CPU가 현재 실행 중인 프로세스나 스레드의 작업을 중단하고, 다른 작업으로 전환하여 실행을 이어가는 과정입니다. 이 과정은 다음과 같은 주요 단계를 포함합니다.

- **상태 저장:** 현재 실행 중인 작업의 상태(레지스터, 프로그램 카운터, 스택 포인터 등)를 해당 작업의 PCB(Process Control Block) 또는 TCB(Thread Control Block)에 저장합니다.
  > **- PCB/TCB란?** 운영체제가 각 프로세스나 스레드를 관리하기 위해 필요한 모든 정보(ID, 상태, 자원 등)를 담아두는 데이터 기록장입니다.

- **상태 복원:** 다음에 실행할 작업의 상태를 PCB 또는 TCB에서 불러와 CPU 레지스터에 복원합니다.

## 2. 컨텍스트 스위칭 비용이 큰 이유

컨텍스트 스위칭은 단순한 작업 전환처럼 보이지만, 실제로는 상당한 시스템 자원을 소모하는 비싼 작업입니다. 주요 원인은 다음과 같습니다.

- **CPU 오버헤드:**
  - 작업의 상태를 저장하고 복원하는 과정 자체가 CPU 사이클을 소모합니다. 이 직접적인 부담을 **커널 오버헤드**라고도 합니다.
    > **- CPU 사이클이란?** CPU가 가장 기본적인 연산 하나를 처리하는 데 걸리는 시간 단위입니다. 사이클을 소모한다는 것은 곧 CPU의 작업 시간을 사용한다는 의미입니다.</br>
    > **- 커널 오버헤드란?** 실제 프로그램의 코드가 아닌, 운영체제(커널)가 시스템 관리를 위해 추가로 수행하는 작업에 드는 비용(시간)을 말합니다.

- **캐시 무효화 (Cache Invalidation):**
  - 컨텍스트 스위칭이 발생하면, 이전에 실행되던 작업이 사용하던 데이터가 담긴 CPU 캐시가 더 이상 유효하지 않게 될 수 있습니다.
    > **- CPU 캐시란?** CPU가 자주 사용하는 데이터를 빠르게 접근하기 위해 내부에 저장해두는 작은 고속 메모리입니다. RAM보다 훨씬 빠릅니다.
  - 새로 실행되는 작업은 필요한 데이터를 캐시에서 찾지 못하고, 메인 메모리(RAM)까지 접근해야 합니다. 이로 인해 <b>캐시 미스(Cache Miss)</b>가 발생하여 메모리 접근 지연 시간이 길어집니다.
    > **- 캐시 미스란?** CPU가 필요한 데이터가 캐시에 없어, 어쩔 수 없이 더 느린 메인 메모리(RAM)까지 데이터를 가지러 가는 상황을 말합니다.

- **메모리 대역폭 소모:**
  - 캐시 미스로 인해 메인 메모리 접근이 잦아지면, 시스템의 메모리 대역폭을 추가로 소모하게 되어 다른 작업에도 영향을 줄 수 있습니다.
    > **- 메모리 대역폭이란?** 정해진 시간 동안 메모리(RAM)와 데이터를 주고받을 수 있는 데이터의 총량(또는 속도)입니다. '데이터가 다니는 길의 너비'에 비유할 수 있습니다.

## 3. 결론

이러한 이유로 컨텍스트 스위칭은 시스템 전체 성능에 큰 영향을 미칩니다. 스위칭이 너무 빈번하게 발생하면, 실제 유저 레벨의 작업을 처리하는 시간보다 컨텍스트 스위칭에 소모되는 시간이 더 커져 성능 저하로 이어질 수 있습니다.

> 따라서 운영체제 스케줄러나 실시간 시스템에서는 컨텍스트 스위칭 횟수를 최소화하고, 한 번의 실행 시간을 적절히 조절하는 전략이 매우 중요합니다.
> > **- 운영체제 스케줄러란?** 어떤 프로세스/스레드에게 CPU 사용 시간을 할당해 줄지 결정하고 관리하는 운영체제의 핵심 기능입니다.
