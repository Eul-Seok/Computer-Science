# 데드락 (Deadlock, 교착 상태)

## 1. 데드락이란?

데드락은 **두 개 이상의 프로세스(또는 스레드)가 서로 상대방의 작업이 끝나기만을 기다리며, 다음 단계를 진행하지 못하는 무한 대기 상태**에 빠지는 것을 말합니다.

- **비유:** 두 사람이 외나무다리 양 끝에서 마주친 상황과 같습니다. 서로 상대방이 비켜주기만을 기다리지만, 아무도 양보하지 않아 영원히 길을 건너지 못하는 상태입니다.

## 2. 데드락 발생의 4가지 조건

데드락은 다음 **네 가지 조건이 모두 동시에 만족**될 때 발생할 수 있습니다. 하나라도 만족되지 않으면 데드락은 발생하지 않습니다.

### 가. 상호 배제 (Mutual Exclusion)
- 하나의 자원은 한 번에 하나의 프로세스만 사용할 수 있어야 합니다.
- **설명:** 다른 프로세스가 사용 중인 자원을 또 다른 프로세스가 동시에 사용할 수 없습니다. (e.g., 프린터는 한 번에 한 명의 사용자만 사용 가능)

### 나. 점유와 대기 (Hold and Wait)
- 프로세스가 최소한 하나의 자원을 점유하고 있는 상태에서, 다른 프로세스가 사용 중인 자원을 추가로 요청하며 대기해야 합니다.
- **설명:** 자신의 자원(e.g., 스캐너)을 계속 가지고 있으면서, 남의 자원(e.g., 프린터)을 달라고 요청하는 상태입니다.

### 다. 비선점 (No Preemption)
- 다른 프로세스가 점유한 자원을 강제로 빼앗을(선점할) 수 없어야 합니다.
- **설명:** 자원의 사용이 끝나면 해당 프로세스가 자발적으로 반납해야만 다른 프로세스가 사용할 수 있습니다.

### 라. 순환 대기 (Circular Wait)
- 자원을 기다리는 프로세스들 간의 관계가 원형(Cycle)을 이루어야 합니다.
- **설명:** 프로세스 P1은 P2의 자원을, P2는 P3의 자원을, ..., Pn은 P1의 자원을 기다리는 꼬리물기 상태가 형성됩니다.

## 3. 데드락 해결 전략

이 네 가지 조건이 모두 충족되면 데드락이 발생할 **가능성**이 생깁니다. 운영체제는 이러한 데드락 문제를 해결하기 위해 다음과 같은 전략을 사용합니다.

- **예방(Prevention):** 네 가지 조건 중 하나 이상이 만족되지 않도록 시스템을 설계하는 가장 근본적인 방법입니다.
  - **자원 요청 순서 고정:** 모든 프로세스가 자원을 동일한 순서로만 요청하도록 강제하여 '순환 대기'를 방지합니다.
  - **타임아웃 기반 락 회수:** 일정 시간 동안 자원을 획득하지 못하면 요청을 취소하고 다시 시도하게 하여 '점유와 대기'를 완화합니다.
  - **락 계층화(Lock Hierarchy):** 자원에 우선순위를 부여하고, 낮은 우선순위 자원부터 획득하도록 강제하여 데드락을 예방합니다.

- **회피(Avoidance):** 자원 할당 시, 데드락을 유발할 가능성이 있는 요청을 거부하는 방식입니다.
  - **e.g., 은행원 알고리즘(Banker's Algorithm):** '안전 상태(Safe State)'는 모든 프로세스가 결국에는 작업을 완료할 수 있는 순서가 존재하는 상태를 의미합니다. 은행원 알고리즘은 자원 요청을 가상으로 시뮬레이션하여, 할당 후에도 시스템이 안전 상태를 유지할 수 있을 때만 요청을 허용합니다.

- **탐지 및 회복(Detection & Recovery):** 데드락 발생을 허용하되, 주기적으로 데드락을 탐지하고 회복합니다. 주로 데드락 발생 가능성이 높은 배치 시스템 등에서 사용됩니다.
  - **탐지:** **자원 할당 그래프(Resource Allocation Graph)** 를 분석하여 사이클이 존재하는지 확인함으로써 데드락을 탐지합니다.
  - **회복:** 데드락에 관련된 프로세스 중 우선순위가 낮거나, 작업 내용의 롤백(rollback)이 용이한 프로세스를 선택하여 강제 종료하거나, 자원을 선점하여 데드락을 해소합니다. 이때 시스템의 일관성과 데이터 무결성을 신중히 고려해야 합니다.

## 4. 심화: 유사 개념 비교

| 구분 | 데드락 (Deadlock) | 라이브락 (Livelock) | 기아 (Starvation) |
| :--- | :--- | :--- | :--- |
| **상태** | 프로세스들이 **대기(Blocked)** 상태 | 프로세스들이 **활성(Active)** 상태에서 특정 작업을 반복함 | 특정 프로세스가 계속 **실행 가능(Ready)** 상태로 남아 있음 |
| **진행** | 서로를 기다리며 **진행 불가** | 서로 양보하느라 **진행 불가** | 다른 프로세스에 밀려 **실행 불가** |
| **원인** | 자원 점유 및 순환 대기 | 잘못된 상호작용/양보 로직 | 스케줄링 정책 (e.g., 우선순위) |
| **비유** | 외나무다리에서 마주친 두 사람 | 좁은 복도에서 서로 비켜주려다 계속 부딪히는 두 사람 | 인기 식당에서 계속 새치기당하는 손님 |