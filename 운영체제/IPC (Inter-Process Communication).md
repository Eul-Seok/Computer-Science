# IPC (Inter-Process Communication)

## 1. IPC란 무엇이며, 왜 필요한가요?

**IPC(Inter-Process Communication)**는 단어 그대로 **프로세스 간 통신**을 의미합니다. 운영체제는 각 프로세스에 독립적인 메모리 공간을 할당하여 안정성을 보장합니다. 이 때문에 하나의 프로세스는 다른 프로세스의 메모리 영역에 직접 접근할 수 없습니다. 따라서 프로세스들은 IPC 없이는 서로 통신할 수 없습니다.

하지만 여러 프로세스가 협력하여 하나의 작업을 처리해야 하는 경우가 많기 때문에, 이들 간에 데이터를 주고받거나 작업을 동기화할 수 있는 통신 방법이 필요합니다. 이때 사용되는 것이 바로 IPC입니다.

> - **프로세스(Process):** 운영체제에서 실행 중인 프로그램의 인스턴스. 자신만의 고유한 메모리 공간, 파일 핸들, 시스템 자원 등을 할당받습니다.
> - **독립된 메모리 공간:** 하나의 프로세스가 사용하는 메모리 영역이 다른 프로세스로부터 완전히 분리되어 있음을 의미합니다. 이는 한 프로세스의 오류가 다른 프로세스에 영향을 미치지 않도록 보호하는 역할을 합니다.


---

## 2. IPC 방식의 종류

IPC 방식은 크게 **공유 메모리 기반**과 **메시지 전달 기반**으로 나눌 수 있습니다.

| 구분 | 설명 | 대표적인 기법 |
|------|------|----------------|
| **공유 메모리 기반** | 여러 프로세스가 하나의 공유된 메모리 영역에 직접 접근하여 데이터를 주고받는 방식. 속도가 빠르지만 동기화가 필수적입니다. | `Shared Memory` |
| **메시지 전달 기반** | 운영체제(커널)가 중간에서 메시지를 간접적으로 전달해주는 방식. 구현이 비교적 간단하고 안전하지만, 속도가 느릴 수 있습니다. | `Pipe`, `Message Queue`, `Socket`, `Signal` |

이 외에도 `Semaphore`와 같이 동기화를 위해 사용되는 기법도 IPC의 범주에 포함됩니다.

> **IPC 방식 선택 가이드**
> - **성능**: 빠른 속도가 중요하다면 공유 메모리, 안정성이 중요하다면 메시지 큐를 선택합니다.
> - **복잡도**: 간단한 통신에는 파이프, 복잡한 구조에는 메시지 큐나 소켓을 사용합니다.

---

## 3. 주요 IPC 기법 비교

### 파이프(Pipe)와 메시지 큐(Message Queue)의 차이

| 구분 | 파이프 (Pipe) | 메시지 큐 (Message Queue) |
|------|----------------|----------------------------|
| **통신 방향** | 단방향 (Half-duplex) | 양방향 (Full-duplex) |
| **통신 단위** | 스트림(Stream) 기반 | 메시지(Message) 구조 |
| **사용 관계** | 부모-자식 등 연관된 프로세스 간 | 관련 없는 프로세스 간에도 사용 가능 |
| **특징** | 간단한 데이터 흐름에 적합 | 구조화된 데이터나 비동기 통신에 유리 |

- **파이프:** 하나의 프로세스는 쓰기만, 다른 하나는 읽기만 할 수 있는 간단한 구조입니다. 주로 부모 프로세스가 자식에게 작업을 전달하는 등 한정된 관계에서 사용됩니다. 예를 들어, 셸에서 `ls | grep "pattern"`과 같이 한 프로그램의 출력을 다른 프로그램의 입력으로 전달할 때 사용됩니다.
- **메시지 큐:** 운영체제가 관리하는 "메시지 보관함"을 통해 데이터를 주고받습니다. 보내는 쪽은 메시지를 큐에 넣고, 받는 쪽은 큐에서 메시지를 꺼내가는 방식이라 양방향 통신이 가능하며, 여러 프로세스가 동시에 접근할 수 있습니다. 이는 생산자-소비자 모델과 같이 비동기적인 데이터 처리에 유용합니다.
- **소켓(Socket):** 네트워크를 통해 서로 다른 컴퓨터에 있는 프로세스 간에도 통신할 수 있게 해주는 양방향 통신 방식입니다. 클라이언트-서버 모델에서 웹 브라우저와 웹 서버 간의 통신 등에 활용됩니다.
- **시그널(Signal):** 운영체제가 프로세스에게 어떤 이벤트가 발생했음을 알려주는 간단한 형태의 메시지입니다. 예를 들어, `Ctrl+C`를 눌러 프로그램을 종료하거나, 자식 프로세스가 종료되었음을 부모 프로세스에게 알리는 데 사용됩니다.

---

### 공유 메모리(Shared Memory) 방식의 장단점

- **장점: 빠른 속도**
  - 공유 메모리는 데이터를 주고받을 때 운영체제를 거치지 않고, 여러 프로세스가 자신의 주소 공간처럼 동일한 메모리에 직접 접근합니다. 이로 인해 데이터 복사 과정이 생략되어 IPC 기법 중 가장 속도가 빠릅니다.
  - 유닉스 계열 시스템에서는 `mmap` (memory-mapped files) 또한 공유 메모리를 구현하는 일반적인 방법 중 하나입니다.

- **단점: 동기화 문제**
 - 여러 프로세스가 동시에 같은 메모리 영역에 접근하면 **경쟁 조건(Race Condition)**이 발생하여 데이터가 손상될 수 있습니다. 따라서 `세마포어(Semaphore)`나 `뮤텍스(Mutex)` 같은 동기화 도구를 반드시 함께 사용하여 접근 순서를 제어해야 합니다.

> **용어 설명**
> - **경쟁 조건(Race Condition):** 여러 프로세스나 스레드가 공유 자원에 동시에 접근하여 수정하려고 할 때, 접근 순서에 따라 결과가 달라지는 현상입니다. 데이터의 일관성을 해칠 수 있어 반드시 제어되어야 합니다.

---

## 4. IPC에서 동기화는 왜 중요할까요?

IPC의 목적은 단순히 데이터를 전달하는 것을 넘어, 여러 프로세스가 **안전하게 협력**하도록 만드는 데 있습니다. 만약 동기화가 없다면, 공유 자원에 대한 동시 접근으로 인해 시스템 전체가 불안정해질 수 있습니다.

예를 들어, 공유 메모리에 저장된 은행 계좌 잔액을 두 프로세스가 동시에 수정한다고 가정해봅시다. 하나의 프로세스가 값을 읽어간 직후 다른 프로세스가 값을 수정하면, 먼저 읽어간 프로세스는 엉뚱한 값을 기반으로 연산을 수행하게 되어 최종 결과가 틀려지게 됩니다.

이러한 문제를 방지하기 위해 **세마포어**나 **뮤텍스** 같은 동기화 도구를 사용하여 한 번에 하나의 프로세스만 공유 자원에 접근하도록 제어합니다. 이를 통해 데이터의 **일관성**과 **안정성**을 확보할 수 있습니다.

> **용어 설명**
> - **세마포어(Semaphore):** 공유 자원에 접근할 수 있는 프로세스의 최대 허용 개수를 나타내는 정수 값입니다. 자원이 여러 개일 때 사용됩니다.
> - **뮤텍스(Mutex):** 'Mutual Exclusion'의 약자로, 오직 하나의 프로세스(또는 스레드)만 공유 자원에 접근할 수 있도록 하는 잠금(Lock) 메커니즘입니다. 자원이 하나일 때 사용됩니다.

> **세마포어 vs 뮤텍스**
> - **세마포어**: 여러 프로세스/스레드가 동시에 자원에 접근 가능 (자원 수 > 1)
> - **뮤텍스**: 오직 하나의 프로세스/스레드만 자원에 접근 가능 (자원 수 = 1)
---

## 5. 심화

### 실제 사용 사례

예를 들어 웹 서버에서 워커 프로세스들이 클라이언트 요청을 처리할 때, 공유 메모리를 통해 캐시된 데이터를 참조하거나, 메시지 큐를 통해 작업 요청을 전달받는 구조로 IPC가 활용됩니다.

### 보안 고려

IPC는 자원 공유를 가능하게 하지만, 잘못된 접근 제어나 인증 없이 사용되면 보안 취약점이 될 수 있기 때문에, 권한 설정이나 접근 제어가 중요합니다.

### IPC와 스레드 간 통신의 차이

> **프로세스 vs 스레드 통신**
> - **프로세스**: 독립된 메모리 공간, IPC 필요
> - **스레드**: 공유 메모리 공간, IPC 불필요 (하지만 공유 데이터에 대한 경쟁 조건 방지를 위해 동기화는 필요)

“스레드는 같은 프로세스 내에서 메모리를 공유하기 때문에 IPC 없이도 통신이 가능하지만, 프로세스 간에는 반드시 IPC가 필요합니다.”

다양한 IPC 기법들은 각각 다른 성능 특성을 가집니다. 다음은 주요 IPC 기법들의 성능을 비교한 표입니다.

### IPC 성능 비교

| 방식 | 장점 | 단점 |
|------|------|------|
| **공유 메모리** | 가장 빠름 (직접 접근) | 동기화 필요, 보안 취약 가능성 |
| **메시지 큐** | 구조화된 통신, 비동기 가능 | 커널 오버헤드, 속도 느림 |
| **소켓** | 네트워크 기반, 유연함 | 가장 느림, 설정 복잡 |

공유 메모리는 속도는 빠르지만 동기화 비용이 크고, 메시지 큐는 구조화된 통신에 유리하지만 커널 오버헤드가 있습니다. 소켓은 네트워크 기반이기 때문에 가장 유연하지만 가장 느립니다.

### IPC와 시스템 콜의 관계

IPC 대부분은 **시스템 콜을 통해 구현**됩니다.

- 예: `pipe()`, `msgget()`, `shmget()`, `semop()` 등
- 사용자 공간에서 커널 공간으로의 전환이 포함되며, 이 과정에서 **문맥 전환 비용**이 발생합니다.

> 시스템 콜은 사용자 프로그램이 운영체제의 기능을 요청하는 인터페이스이며, IPC는 그 대표적인 사용 사례입니다.

> **시스템 콜 (System Call)이란?**
> - 사용자 모드에서 커널 모드로 전환하여 운영체제의 서비스를 요청하는 함수입니다.
> - `read()`, `write()`, `pipe()`, `fork()` 등이 대표적인 예시입니다.

### IPC와 동기 vs 비동기 통신

- **동기 통신**: 송신자와 수신자가 동시에 존재해야 함 (예: 파이프)
 - **비동기 통신**: 메시지를 큐에 넣고, 수신자는 나중에 꺼내도 됨 (예: 메시지 큐, 소켓)

메시지 큐나 소켓은 비동기 통신을 지원할 수 있어서, 송신자와 수신자가 동시에 존재하지 않아도 됩니다. 반면 파이프는 동기적 특성이 강해서, 읽기/쓰기 타이밍을 맞춰야 합니다.

### IPC와 메모리 보호

IPC는 자원 공유를 가능하게 하지만, **메모리 보호 관점에서는 잠재적인 위험 요소**가 될 수 있습니다.

- 특히 공유 메모리 방식은 여러 프로세스가 동일한 메모리 영역에 접근하기 때문에, **접근 권한 설정이 매우 중요**합니다.
- 권한 설정이 허술하거나 인증 절차가 없다면, 악성 프로세스가 민감한 데이터를 탈취하거나 시스템을 교란할 수 있습니다.
- 운영체제는 `shmctl()` 같은 시스템 콜을 통해 공유 메모리의 접근 권한을 제어하며, 프로세스 간 안전한 통신을 보장합니다.

> **보안 팁**
> IPC를 사용할 때는 반드시 접근 권한, 인증 절차, 자원 해제 시점 등을 명확히 설정해야 하며, 특히 공유 메모리 방식은 권한 설정이 허술하면 보안 취약점으로 이어질 수 있습니다.