# 프로세스 제어 블록 (PCB, Process Control Block)

## 1. PCB란 무엇인가?

<b>PCB(Process Control Block)</b>는 운영체제가 특정 프로세스를 관리하기 위해 필요한 모든 정보를 담고 있는 핵심 자료구조입니다. 흔히 '프로세스의 명함'에 비유할 수 있습니다.

-   프로세스가 생성될 때마다 운영체제는 고유한 PCB를 하나씩 만들고, 프로세스가 종료되면 PCB는 폐기됩니다.
-   운영체제는 모든 활성 프로세스의 PCB를 <b>프로세스 테이블(Process Table)</b>이라는 자료구조에 저장해두고, 이를 기반으로 스케줄링이나 자원 관리 같은 핵심 작업을 수행합니다.

## 2. PCB에 저장되는 주요 정보

PCB에는 프로세스 관리에 필요한 다음과 같은 다양한 정보가 포함됩니다.

-   **프로세스 식별자 (PID):** 각 프로세스를 고유하게 식별하는 번호.
-   **프로세스 상태 (Process State):** 현재 프로세스가 어떤 상태인지 (e.g., 생성, 준비, 실행, 대기, 종료).
-   **프로그램 카운터 (Program Counter):** 다음에 실행할 명령어의 주소.
    > CPU가 다음에 실행해야 할 메모리상의 명령어 주소를 가리키는 특수 레지스터입니다.
-   **CPU 레지스터:** 이전 실행 시점의 레지스터 값들 (e.g., 누산기, 인덱스 레지스터 등). 문맥 전환 시 이 값들을 저장하고 복원해야 합니다.
    > CPU 내부에 존재하는 매우 빠른 임시 저장 공간으로, 연산에 필요한 데이터나 주소 등을 잠시 보관합니다.
-   **메모리 관리 정보:** 해당 프로세스가 할당받은 메모리 공간의 정보 (e.g., 기준 레지스터, 한계 레지스터).
    > - **기준 레지스터 (Base Register):** 프로세스가 할당받은 메모리 공간의 시작 주소를 저장합니다.
    > - **한계 레지스터 (Limit Register):** 해당 프로세스가 사용할 수 있는 메모리의 크기(범위)를 저장합니다. 이 두 레지스터는 다른 프로세스의 영역을 침범하지 못하도록 보호하는 '울타리' 역할을 합니다.
-   **열린 파일 목록:** 프로세스가 열어서 사용 중인 파일들의 목록.
-   **우선순위:** CPU 스케줄링 시 사용되는 프로세스의 중요도.

## 3. 프로세스 상태 전이(State Transition)와 PCB

프로세스는 실행되는 동안 여러 상태를 오가며, 그때마다 PCB의 상태 정보가 업데이트됩니다.

-   **생성 (New):** 프로세스가 막 생성된 상태.
-   **준비 (Ready):** CPU를 할당받기 위해 준비 큐(Ready Queue)에서 대기 중인 상태.
-   **실행 (Running):** CPU를 할당받아 명령어를 실행 중인 상태.
-   **대기 (Waiting/Blocked):** 입출력(I/O) 작업이나 특정 이벤트가 끝나기를 기다리는 상태.
-   **종료 (Terminated):** 프로세스 실행이 완료된 상태.

이러한 상태 변화는 CPU 스케줄러, 인터럽트, 시스템 콜 등에 의해 촉발됩니다.
> - **스케줄러:** 어떤 프로세스에게 CPU를 할당할지 결정하는 운영체제의 핵심 구성 요소입니다.
> - **인터럽트:** CPU가 프로그램을 실행하는 도중에, 외부 장치의 요청이나 예외 상황이 발생하여 현재 작업을 멈추고 다른 작업을 처리하도록 하는 신호입니다.
> - **시스템 콜:** 응용 프로그램이 파일 열기, 네트워크 통신 등 운영체제의 기능을 사용하기 위해 커널에게 서비스를 요청하는 방법입니다.

## 4. 문맥 전환(Context Switch)과 PCB의 역할

<b>문맥 전환(Context Switch)</b>은 하나의 프로세스에서 다른 프로세스로 CPU 제어권을 넘겨주는 과정이며, PCB는 이 과정에서 결정적인 역할을 합니다.

1.  **저장 (Save):** 현재 실행 중인 프로세스(P1)의 CPU 레지스터 값, 프로그램 카운터 등 모든 상태를 P1의 PCB에 저장합니다.
2.  **복원 (Restore):** 다음에 실행할 프로세스(P2)의 PCB를 참조하여, 이전에 저장해두었던 상태를 CPU에 그대로 복원합니다.

> **문맥 전환의 숨겨진 비용:** 문맥 전환은 단순한 함수 호출보다 훨씬 무거운 작업입니다. CPU 레지스터 상태를 저장하고 복원하는 것 외에도, 이전 프로세스가 사용하던 CPU 캐시 데이터가 무효화되고(Cache Flush), 가상-물리 주소 변환 속도를 높이는 캐시인 <b>TLB(Translation Lookaside Buffer)</b>의 내용이 초기화되는 등의 부가적인 작업이 발생합니다. 이 때문에 빈번한 문맥 전환은 시스템 성능에 직접적인 타격을 줍니다.

이러한 PCB를 통한 상태 저장 및 복원 메커니즘 덕분에, 운영체제는 여러 프로세스가 마치 동시에 실행되는 것처럼 보이게 만들 수 있습니다.

## 5. 스레드와 PCB의 관계

스레드는 프로세스 내의 실행 단위이므로, 하나의 프로세스(PCB) 아래에 여러 스레드가 존재할 수 있습니다.

-   **자원 공유:** 한 프로세스에 속한 스레드들은 해당 프로세스의 PCB에 있는 자원(메모리 공간, 열린 파일 등)을 공유합니다.
-   **독립적인 실행 흐름:** 하지만 각 스레드는 자신만의 실행 상태(레지스터 값, 프로그램 카운터, 스택)를 가지며, 이는 <b>스레드 제어 블록(TCB, Thread Control Block)</b>이라는 별도의 자료구조에 저장됩니다.

즉, 문맥 전환이 일어날 때, 같은 프로세스 내의 스레드 간 전환은 TCB 정보만 바꾸면 되므로 비용이 적지만, 다른 프로세스의 스레드로 전환될 때는 PCB 정보까지 모두 바꿔야 하므로 훨씬 큰 비용이 발생합니다.

## 6. 실무적 중요성

> PCB는 운영체제가 프로세스를 ‘기억하고’, ‘관리하고’, ‘전환하는’ 데 필요한 모든 정보를 담고 있는 핵심 구조입니다.

-   PCB는 운영체제의 스케줄링, 메모리 관리, 입출력 처리 등 거의 모든 기능의 근간이 되는 자료구조입니다.
-   특히 **문맥 전환은 상당한 오버헤드(비용)를 유발**하므로, 시스템의 성능을 최적화하기 위해서는 문맥 전환 횟수를 최소화하는 스케줄링 전략을 설계하는 것이 매우 중요합니다.
    > **오버헤드(Overhead)란?** 어떤 작업을 처리하는 데 드는 직접적인 시간 외에, 그 작업을 준비하고 마무리하는 데 드는 추가적인 시간이나 자원을 의미합니다. 문맥 전환에서는 실제 작업(프로세스 실행)이 아닌, 상태 저장/복원 같은 부가적인 작업이 오버헤드에 해당합니다.
