# 02. TCP와 UDP의 특징과 차이점

TCP(Transmission Control Protocol)와 UDP(User Datagram Protocol)는 OSI 7계층 중 <b>전송 계층(Transport Layer)</b>에서 사용되는 대표적인 프로토콜입니다. 두 프로토콜은 데이터 전송 방식과 신뢰성 측면에서 명확한 차이를 보이며, 애플리케이션의 특성에 따라 적절한 프로토콜이 선택됩니다.

## 1. TCP (Transmission Control Protocol)

TCP는 **연결 지향형(Connection-oriented)** 프로토콜로, 데이터를 전송하기 전에 반드시 상대방과 연결을 설정하는 과정을 거칩니다. 이를 통해 데이터의 신뢰성 있는 전송을 보장합니다.

### 주요 특징
-   **연결 지향 (Connection-oriented)**: 3-way handshake를 통해 연결을 설정하고, 4-way handshake를 통해 연결을 해제합니다.
    -   **3-way handshake**:
        1.  SYN (클라이언트 -> 서버)
        2.  SYN-ACK (서버 -> 클라이언트)
        3.  ACK (클라이언트 -> 서버) -> 연결 완료
    -   **4-way termination**:
        1.  FIN (클라이언트 -> 서버)
        2.  ACK (서버 -> 클라이언트)
        3.  FIN (서버 -> 클라이언트)
        4.  ACK (클라이언트 -> 서버) -> 연결 종료
> **SYN (Synchronize Sequence Numbers)**: 연결을 시작하기 위해 클라이언트가 서버에 보내는 요청 패킷입니다. 시퀀스 번호를 동기화하자는 의미를 가집니다.<br>
> **ACK (Acknowledgement)**: 상대방으로부터 패킷을 잘 받았다는 것을 알려주는 응답 패킷입니다.<br>
> **FIN (Finish)**: 연결을 종료하겠다는 요청 패킷입니다.

-   **높은 신뢰성 (Reliable)**: 데이터의 순서를 보장하고, 패킷이 손실될 경우 재전송(ARQ)을 통해 복구합니다. 데이터의 경계를 구분하지 않는 **스트림(Stream)** 기반 전송을 합니다.
-   **흐름 제어 (Flow Control)**: 수신 측의 처리 능력을 고려하여 송신 측의 데이터 전송량을 조절합니다. (Sliding Window 방식)
-   **혼잡 제어 (Congestion Control)**: 네트워크의 혼잡 상태를 파악하고, 전송 속도를 동적으로 조절하여 네트워크 과부하를 방지합니다. (Slow Start, Congestion Avoidance 등)

> **TCP 헤더 구조 (20~60 Bytes)**:
> -   Source Port (출발지 포트)
> -   Destination Port (목적지 포트)
> -   Sequence Number (시퀀스 번호): 송신하는 데이터의 순서를 나타냅니다.
> -   Acknowledgement Number (ACK 번호): 수신할 다음 데이터의 시퀀스 번호를 알려줍니다.
> -   Data Offset (헤더 길이)
> -   Reserved (예약 필드)
> -   Flags (플래그): SYN, ACK, FIN, RST, PSH, URG 등 연결 설정 및 제어에 사용됩니다.
> -   Window Size (윈도우 크기): 흐름 제어를 위한 수신 버퍼의 크기를 나타냅니다.
> -   Checksum (체크섬): 데이터 오류 검출에 사용됩니다.
> -   Urgent Pointer (긴급 포인터)
> -   Options (옵션): 선택적 기능 (최대 세그먼트 크기 등)

### 사용 사례
신뢰성이 중요한 데이터 전송에 사용됩니다.
-   웹 브라우징 (HTTP/HTTPS)
-   파일 전송 (FTP)
-   이메일 (SMTP)
-   채팅, 로그인 등 게임 내 신뢰성 있는 데이터

## 2. UDP (User Datagram Protocol)

UDP는 **비연결형(Connectionless)** 프로토콜로, 연결 설정 과정 없이 데이터를 전송합니다. 신뢰성보다는 속도와 실시간성을 우선시합니다.

### 주요 특징
-   **비연결형 (Connectionless)**: 연결 설정 없이 데이터를 보내므로 전송 속도가 빠릅니다.
-   **낮은 신뢰성 (Unreliable)**: 데이터의 순서가 보장되지 않으며, 패킷 손실이 발생해도 재전송하지 않습니다. **데이터그램(Datagram)** 단위로 데이터를 전송하며, 각 패킷은 독립적으로 처리됩니다.
-   **최소한의 오버헤드**: 신뢰성 보장을 위한 기능이 없으므로 TCP에 비해 헤더가 단순하고 오버헤드가 적습니다.
    -   **UDP 헤더 구조 (8 Bytes)**:
        -   Source Port (2 Bytes)
        -   Destination Port (2 Bytes)
        -   Length (2 Bytes)
        -   Checksum (2 Bytes)
> **Source Port (출발지 포트)**: 데이터를 보내는 애플리케이션을 식별하는 번호입니다.<br>
> **Destination Port (목적지 포트)**: 데이터를 받을 애플리케이션을 식별하는 번호입니다.<br>
> **Length (길이)**: UDP 헤더와 데이터의 전체 길이를 나타냅니다.<br>
> **Checksum (체크섬)**: 데이터 전송 중 오류가 발생했는지 확인하는 데 사용되는 값입니다.

-   **브로드캐스트 및 멀티캐스트 지원**: 하나의 패킷을 여러 대상에게 동시에 전송할 수 있습니다.
    > **UDP 멀티캐스트 활용 예시**:
    > -   **실시간 스포츠 중계**: 하나의 비디오 스트림을 여러 시청자에게 동시에 전송하여 효율적인 대역폭 사용.
    > -   **게임 내 이벤트 브로드캐스트**: 게임 서버가 특정 지역 내 모든 플레이어에게 게임 이벤트(예: "보스 몬스터 등장!")를 동시에 알릴 때 사용.
    > -   **화상 회의**: 여러 참가자에게 오디오/비디오 데이터를 동시에 전송.

### 사용 사례
실시간성과 빠른 속도가 중요한 서비스에 사용됩니다.
-   실시간 게임 (위치 정보, 입력 등)
-   온라인 스트리밍 (비디오, 오디오)
-   DNS (Domain Name System)
-   VoIP (Voice over IP)

## 3. TCP vs UDP 비교

| 구분 | TCP | UDP |
|---|---|---|
| 연결 방식 | 연결 지향 (Connection-oriented) | 비연결형 (Connectionless) |
| 신뢰성 | 높음 (순서 보장, 재전송) | 낮음 (순서 미보장, 재전송 없음) |
| 속도 | 상대적으로 느림 | 빠름 |
| 헤더 오버헤드 | 큼 (20 bytes ~) | 작음 (8 bytes) |
| 데이터 전송 단위 | 스트림 (Stream) | 데이터그램 (Datagram) |
| 제어 기능 | 흐름 제어, 혼잡 제어 | 없음 |
| 주요 사용처 | 웹, 이메일, 파일 전송 | 실시간 게임, 스트리밍, DNS |

## 4. 게임 환경에서 UDP를 선호하는 이유

FPS나 액션 게임과 같이 실시간 반응이 매우 중요한 게임에서는 TCP의 안정성 기능이 오히려 독이 될 수 있습니다.

-   **지연 문제**: TCP는 패킷 하나가 손실되면 해당 패킷이 재전송되어 도착할 때까지 이후의 모든 패킷 처리가 지연됩니다 (**Head-of-Line Blocking**).
    > **Head-of-Line Blocking (HOL Blocking)**: 순서가 중요한 통신에서, 첫 번째 패킷이 지연되면 그 뒤의 패킷들이 모두 대기해야 하는 현상입니다.
-   **불필요한 재전송**: 게임에서는 최신 데이터가 가장 중요합니다. 예를 들어, 0.1초 전의 캐릭터 위치 정보가 손실되었다고 해서 이를 재전송받는 것은 의미가 없습니다. 차라리 그 시간에 현재 위치 정보를 받는 것이 훨씬 낫습니다.

이러한 이유로 대부분의 실시간 게임에서는 UDP를 기반으로 하되, 신뢰성이 필요한 부분(예: 아이템 획득, 스킬 사용)에 대해서는 애플리케이션 레벨에서 자체적으로 신뢰성을 구현하는 방식을 사용합니다 (**Reliable UDP**).

> **Reliable UDP (RUDP)**: UDP의 빠른 전송 속도를 유지하면서, ACK나 시퀀스 번호 등 신뢰성 보장 기능을 애플리케이션 레벨에서 직접 구현하여 TCP의 단점을 보완하는 방식입니다.

> **게임 엔진에서의 Reliable UDP 구현 예시**:
> -   **ENet 라이브러리**: UDP 기반이지만, 내부적으로 ACK, 시퀀스 번호, 패킷 재전송 기능을 제공하여 TCP 수준의 신뢰성을 구현합니다.
> -   **RakNet 라이브러리**: ENet과 유사하게 UDP 위에 신뢰성, 순서 보장, 혼잡 제어 등의 기능을 추가하여 게임에 최적화된 네트워크 통신을 제공합니다.

실제로 게임에서는 로그인, 결제, 채팅 등 신뢰성이 중요한 부분에는 TCP를, 위치 정보, 입력 이벤트, 물리 연산 등 실시간성이 중요한 부분에는 UDP를 사용하는 혼합 구조가 일반적입니다.

## 5. TCP/UDP 포트 번호의 실무적 활용

TCP와 UDP는 데이터를 전송할 때 IP 주소와 함께 <b>포트 번호(Port Number)</b>를 사용하여 특정 애플리케이션 프로세스에 데이터를 전달합니다. 포트 번호는 0부터 65535까지 있으며, 특정 서비스에 할당된 잘 알려진 포트(Well-known Ports)가 있습니다.

> **포트 번호(Port Number)**: 운영체제 내에서 네트워크 서비스를 제공하는 특정 애플리케이션이나 프로세스를 식별하는 논리적인 번호입니다.

### 주요 포트 번호 예시

| 프로토콜 | 포트 번호 | 서비스 | 설명 |
|---|---|---|---|
| TCP | 20, 21 | FTP (File Transfer Protocol) | 파일 전송 |
| TCP | 22 | SSH (Secure Shell) | 원격 보안 접속 |
| TCP | 23 | Telnet | 원격 터미널 접속 (보안 취약) |
| TCP | 25 | SMTP (Simple Mail Transfer Protocol) | 이메일 전송 |
| UDP | 53 | DNS (Domain Name System) | 도메인 이름을 IP 주소로 변환 |
| TCP | 80 | HTTP (HyperText Transfer Protocol) | 웹 페이지 전송 |
| TCP | 110 | POP3 (Post Office Protocol 3) | 이메일 수신 |
| TCP | 143 | IMAP (Internet Message Access Protocol) | 이메일 수신 (POP3보다 고급 기능) |
| TCP | 443 | HTTPS (HyperText Transfer Protocol Secure) | 보안 웹 페이지 전송 |
| TCP/UDP | 3389 | RDP (Remote Desktop Protocol) | 원격 데스크톱 접속 |
| TCP/UDP | 8080 | HTTP Alternate | 비표준 웹 서비스 |

### 실무적 활용

-   **방화벽 설정**: 특정 포트만 열어두어 외부에서의 접근을 제어하고 보안을 강화합니다. (예: 웹 서버는 80, 443 포트만 허용)
-   **애플리케이션 식별**: 서버에서 여러 서비스(웹 서버, DB 서버, 게임 서버 등)가 동시에 실행될 때, 각 서비스는 고유한 포트 번호를 사용하여 클라이언트 요청을 올바른 서비스로 라우팅합니다.
-   **네트워크 문제 해결**: 특정 서비스에 접속이 안 될 때, 해당 서비스의 포트가 열려 있는지, 다른 프로세스가 사용 중인지 등을 확인하여 문제를 진단합니다.