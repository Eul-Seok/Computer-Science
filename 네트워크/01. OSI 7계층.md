# 01. OSI 7계층

<b>OSI 7계층(Open Systems Interconnection 7 Layers)</b>은 네트워크 통신 과정을 7개의 독립적인 계층으로 나눈 모델입니다. 각 계층은 특정 역할을 담당하며, 하위 계층은 물리적인 데이터 전송을, 상위 계층은 사용자 애플리케이션과의 인터페이스를 담당합니다. 이 모델은 네트워크 통신의 복잡성을 줄이고 표준화를 통해 서로 다른 시스템 간의 통신을 가능하게 합니다.

## 각 계층의 역할

1.  **물리 계층 (Physical Layer)**
    -   **역할**: 비트(bit) 단위의 데이터를 물리적인 매체(케이블, 무선 신호 등)를 통해 전송합니다.
    > **비트(bit)**: 컴퓨터가 처리하는 정보의 최소 단위로, 0 또는 1의 값을 가집니다.
    전기적, 기계적 특성을 정의합니다.

2.  **데이터 링크 계층 (Data Link Layer)**
    -   **역할**: 물리 계층을 통해 송수신되는 데이터에 대한 오류 검출, 흐름 제어, 프레임 동기화 등을 담당합니다. MAC 주소를 사용하여 인접한 두 장치 간의 신뢰성 있는 데이터 전송을 보장합니다.
    > **MAC 주소(Media Access Control Address)**: 네트워크 장치에 부여된 고유한 물리적 주소입니다. 이더넷 카드 등에 하드웨어적으로 할당되며, 데이터 링크 계층에서 통신 대상을 식별하는 데 사용됩니다.

3.  **네트워크 계층 (Network Layer)**
    -   **역할**: 여러 네트워크를 거쳐 목적지까지 데이터를 안전하게 전달하는 라우팅 기능을 담당합니다.
    > **라우팅(Routing)**: 네트워크에서 데이터 패킷이 출발지에서 목적지까지 도달할 수 있는 최적의 경로를 결정하고 그 경로를 따라 데이터를 전달하는 과정입니다.
    IP 주소를 사용하여 경로를 설정하고 패킷을 전송합니다.

    > **IP 주소(Internet Protocol Address)**: 네트워크에 연결된 장치를 식별하는 고유한 논리적 주소입니다. 네트워크 계층에서 데이터를 목적지까지 라우팅하는 데 사용됩니다.

    > **패킷(Packet)**: 네트워크를 통해 전송되는 데이터의 작은 조각입니다. 각 패킷에는 목적지 주소, 출발지 주소, 데이터 등 전송에 필요한 정보가 포함됩니다.

4.  **전송 계층 (Transport Layer)**
    -   **역할**: 송신자와 수신자 간의 신뢰성 있는 데이터 전송을 보장합니다. TCP와 UDP 프로토콜을 사용하여 연결 설정, 흐름 제어, 혼잡 제어 등을 수행합니다.
    -   **프로토콜**: TCP, UDP
    > **TCP(Transmission Control Protocol)**: 신뢰성 있는 데이터 전송을 보장하는 연결 지향형 프로토콜입니다. 데이터의 순서 보장, 재전송, 흐름 제어, 혼잡 제어 기능을 제공합니다.

    > **UDP(User Datagram Protocol)**: 비연결 지향형 프로토콜로, 데이터 전송의 신뢰성보다는 속도를 중요시합니다. 데이터 손실이나 순서 변경이 발생할 수 있지만, 오버헤드가 적어 실시간 스트리밍이나 게임 등 빠른 통신이 필요한 곳에 사용됩니다.

    > **프로토콜(Protocol)**: 네트워크 통신에서 데이터를 교환하기 위한 규칙과 절차의 집합입니다. 통신하는 개체들이 서로 이해하고 상호작용할 수 있도록 약속된 형식과 방법을 정의합니다.
    

5.  **세션 계층 (Session Layer)**
    -   **역할**: 애플리케이션 간의 통신 세션(연결)을 설정, 유지, 종료하는 역할을 합니다.
    > **세션(Session)**: 네트워크 통신에서 두 개 이상의 통신 주체(예: 클라이언트와 서버) 사이에 설정되는 논리적인 연결 또는 대화 상태를 의미합니다.
    동기화 및 복구 기능을 제공합니다.
    
    > **실무적 활용 사례 (게임 서버)**
    > -   **플레이어 로그인 세션 유지**: 사용자가 게임에 로그인하면 세션이 시작되어 게임 플레이 중 연결이 유지됩니다.
    > -   **재접속 처리**: 네트워크 일시 단절 시 기존 세션을 통해 빠르게 게임에 재접속할 수 있도록 돕습니다.
    > -   **세션 타임아웃 관리**: 일정 시간 동안 활동이 없으면 세션을 자동으로 종료하여 서버 자원을 효율적으로 관리합니다.

6.  **표현 계층 (Presentation Layer)**
    -   **역할**: 데이터를 애플리케이션이 이해할 수 있는 형식으로 변환하거나, 암호화/복호화, 압축/압축 해제 등을 수행합니다.
    >
    > **인코딩/압축 예시 (게임 내 리소스 처리)**
    > -   **인코딩**: 게임 내 텍스트 데이터(예: 채팅 메시지, UI 텍스트)를 `UTF-8`과 같은 표준 인코딩으로 변환하여 다양한 언어를 지원하고 호환성을 확보합니다.
    > -   **압축**: 게임 리소스(예: 이미지 파일 `PNG`, 텍스처, 3D 모델 데이터)를 압축하여 네트워크 전송량을 줄이고 로딩 시간을 단축합니다.
    > -   **데이터 형식 변환**: 서버와 클라이언트 간에 데이터를 주고받을 때 `JSON`, `XML` 또는 `Protocol Buffers`와 같은 특정 데이터 형식으로 변환하여 통신합니다.

7.  **응용 계층 (Application Layer)**
    -   **역할**: 사용자에게 네트워크 서비스를 제공합니다. HTTP, FTP, SMTP 등 다양한 애플리케이션 프로토콜이 이 계층에서 동작합니다.

## OSI 모델의 수직 흐름 시각화

OSI 7계층 모델에서 데이터는 송신 측에서는 상위 계층에서 하위 계층으로 순차적으로 전달되며 각 계층에서 필요한 헤더(Header)나 트레일러(Trailer)가 추가됩니다(캡슐화).
> **헤더(Header)**: 데이터의 앞부분에 붙는 제어 정보입니다. 송신자와 수신자의 주소, 데이터의 크기, 순서 번호 등 데이터 전송에 필요한 다양한 정보가 담겨 있습니다.

> **트레일러(Trailer)**: 데이터의 뒷부분에 붙는 제어 정보입니다. 주로 데이터 오류 검출을 위한 정보(예: 체크섬)가 포함됩니다.

> **캡슐화(Encapsulation)**: 상위 계층의 데이터에 하위 계층의 헤더나 트레일러를 추가하여 데이터를 포장하는 과정입니다. 각 계층은 자신에게 필요한 제어 정보를 추가합니다.

> **캡슐화 예시 (HTTP 요청)**
> 1.  **응용 계층**: 웹 브라우저에서 `HTTP 요청 메시지` 생성 (예: `GET /index.html`)
> 2.  **전송 계층**: HTTP 메시지에 `TCP 헤더` 추가 -> `TCP 세그먼트` (HTTP 메시지 + TCP 헤더)
> 3.  **네트워크 계층**: TCP 세그먼트에 `IP 헤더` 추가 -> `IP 패킷` (TCP 세그먼트 + IP 헤더)
> 4.  **데이터 링크 계층**: IP 패킷에 `MAC 헤더`와 `트레일러` 추가 -> `이더넷 프레임` (IP 패킷 + MAC 헤더 + 트레일러)
> 5.  **물리 계층**: 이더넷 프레임이 전기 신호(비트)로 변환되어 물리 매체를 통해 전송

**OSI 모델 캡슐화 흐름 요약**
```
[Application Data]
↓ + Presentation Header
[Presentation Data]
↓ + Session Header
[Session Data]
↓ + Transport Header
[Segment]
↓ + Network Header
[Packet]
↓ + Data Link Header + Trailer
[Frame]
↓ Physical Transmission (Bits)
```

수신 측에서는 반대로 하위 계층에서 상위 계층으로 전달되며 각 계층에서 헤더/트레일러가 제거됩니다(역캡슐화).
> **역캡슐화(Decapsulation)**: 수신 측에서 하위 계층으로부터 데이터를 받아 상위 계층으로 전달하기 전에 해당 계층에서 추가된 헤더나 트레일러를 제거하는 과정입니다.

-   **송신 시**: 응용 계층 -> 표현 계층 -> 세션 계층 -> 전송 계층 -> 네트워크 계층 -> 데이터 링크 계층 -> 물리 계층
-   **수신 시**: 물리 계층 -> 데이터 링크 계층 -> 네트워크 계층 -> 전송 계층 -> 세션 계층 -> 표현 계층 -> 응용 계층

이러한 수직적인 흐름을 통해 각 계층은 독립적인 기능을 수행하면서도 전체적인 통신 과정을 완성합니다.

## TCP/IP 모델과의 관계

실제 인터넷은 OSI 7계층 모델이 아닌 **TCP/IP 모델**을 기반으로 동작합니다. TCP/IP 모델은 OSI 모델보다 간소화된 4계층 또는 5계층 구조를 가지지만, OSI 모델은 네트워크 통신 과정을 개념적으로 이해하고 문제 해결에 접근하는 데 매우 유용합니다.

## TCP/IP 모델의 4계층 구조 매핑

면접 등에서 OSI 7계층과 TCP/IP 4계층을 빠르게 대응시켜 설명하면 네트워크 구조에 대한 이해도를 효과적으로 보여줄 수 있습니다.

| TCP/IP 4계층 | OSI 7계층 | 주요 역할 |
|---|---|---|
| **애플리케이션 계층 (Application)** | 응용, 표현, 세션 계층 (5~7계층) | 사용자에게 서비스 제공, 데이터 형식 변환, 세션 관리 |
| **전송 계층 (Transport)** | 전송 계층 (4계층) | 종단 간 신뢰성 있는 데이터 전송 (TCP, UDP) |
| **인터넷 계층 (Internet)** | 네트워크 계층 (3계층) | IP 주소 기반 라우팅, 패킷 전송 (IP) |
| **네트워크 액세스 계층 (Network Access)** | 데이터 링크, 물리 계층 (1~2계층) | 물리적 매체를 통한 데이터 전송, MAC 주소 기반 통신 |

**TCP/IP 모델 실제 프로토콜 예시**
-   **Application 계층**: HTTP, FTP, DNS
-   **Transport 계층**: TCP, UDP
-   **Internet 계층**: IP, ICMP
-   **Network Access 계층**: Ethernet, Wi-Fi

## TCP/IP 모델: 4계층 vs 5계층

TCP/IP 모델은 OSI 7계층 모델을 기반으로 하지만, 실제 인터넷 환경에 맞게 간소화된 모델입니다. 일반적으로 4계층 모델이 널리 사용되지만, 때로는 5계층 모델로 설명되기도 합니다. 이 두 모델의 차이는 주로 '네트워크 액세스 계층'을 어떻게 세분화하는지에 있습니다.

### TCP/IP 4계층 모델

가장 일반적인 형태로, OSI 모델의 물리 계층과 데이터 링크 계층을 '네트워크 액세스 계층' 하나로 통합합니다.

-   **애플리케이션 계층 (Application Layer)**: OSI의 응용, 표현, 세션 계층을 포함. (HTTP, FTP, SMTP 등)
-   **전송 계층 (Transport Layer)**: OSI의 전송 계층과 동일. (TCP, UDP)
-   **인터넷 계층 (Internet Layer)**: OSI의 네트워크 계층과 동일. (IP)
-   **네트워크 액세스 계층 (Network Access Layer)**: OSI의 데이터 링크, 물리 계층을 포함. (이더넷, Wi-Fi 등)

### TCP/IP 5계층 모델

4계층 모델에서 '네트워크 액세스 계층'을 OSI 모델처럼 '데이터 링크 계층'과 '물리 계층'으로 분리하여 설명하는 경우입니다. 이는 하드웨어적인 측면과 논리적인 데이터 전송 측면을 좀 더 명확히 구분하고자 할 때 사용됩니다.

-   **애플리케이션 계층 (Application Layer)**
-   **전송 계층 (Transport Layer)**
-   **인터넷 계층 (Internet Layer)**
-   **데이터 링크 계층 (Data Link Layer)**: OSI의 데이터 링크 계층과 동일.
-   **물리 계층 (Physical Layer)**: OSI의 물리 계층과 동일.

### 주요 차이점

-   **계층 수**: 4계층 모델은 4개의 계층, 5계층 모델은 5개의 계층으로 구성됩니다.
-   **세분화 정도**: 5계층 모델이 하위 계층(데이터 링크, 물리)을 더 세분화하여 OSI 모델에 가깝게 설명합니다.
-   **활용**: 4계층 모델은 개념적 이해와 일반적인 설명에 주로 사용되며, 5계층 모델은 특정 기술이나 하드웨어적 측면을 강조할 때 유용할 수 있습니다. 실제 구현에서는 4계층 모델이 더 흔하게 언급됩니다.

## 게임 개발 실무 (C++) 관점

게임 개발자는 OSI 7계층 모델의 모든 계층을 직접 다루지는 않지만, 각 계층의 역할을 이해하는 것은 네트워크 기반 게임을 개발하는 데 필수적입니다.

-   **물리/데이터 링크/네트워크 계층**: 주로 하드웨어 및 OS, 네트워크 장비(라우터, 스위치)가 담당합니다. 게임 개발자는 이 계층의 직접적인 구현보다는, 네트워크 지연(Latency)이나 패킷 손실과 같은 현상이 발생하는 원인을 이해하는 데 활용합니다. 예를 들어, 네트워크 계층의 라우팅 문제로 인해 특정 지역 플레이어의 핑이 높을 수 있음을 인지하는 식입니다.
-   **전송 계층**: 게임 개발자가 가장 많이 직접적으로 다루는 계층입니다.
    -   **TCP**: 로그인, 채팅, 결제, 게임 상태 동기화 등 신뢰성 있는 데이터 전송이 필요한 부분에 사용됩니다. C++에서는 `boost::asio`나 `winsock` 같은 라이브러리를 통해 TCP 소켓 프로그래밍을 합니다.
    -   **UDP**: 실시간 위치 정보, 입력 이벤트, 물리 연산 등 빠른 전송과 낮은 지연이 중요한 부분에 사용됩니다. C++에서는 UDP 소켓을 직접 구현하거나, `RakNet`, `ENet` 같은 게임 네트워크 라이브러리를 사용합니다.
-   **세션/표현/응용 계층**: 게임의 핵심 로직과 프로토콜이 이 계층에 해당합니다.
    -   **세션**: 게임 서버와의 연결 유지, 플레이어 인증, 세션 관리 등이 포함됩니다.
    -   **표현**: 게임 데이터(캐릭터 위치, 아이템 정보 등)의 직렬화/역직렬화(예: Protocol Buffers, FlatBuffers), 암호화(예: TLS/SSL) 등이 이루어집니다.
    > **직렬화(Serialization)**: 메모리 상의 객체나 데이터를 저장하거나 네트워크를 통해 전송할 수 있는 연속적인 바이트 스트림 형태로 변환하는 과정입니다.
    
    > **역직렬화(Deserialization)**: 직렬화된 바이트 스트림을 다시 원래의 객체나 데이터 구조로 복원하는 과정입니다.
    -   **응용**: 게임 클라이언트와 서버 간의 통신 프로토콜(예: 게임별 커스텀 프로토콜), API 호출, 게임 로직 처리 등이 이 계층에서 구현됩니다. C++에서는 게임 엔진(Unreal Engine, Unity)의 네트워크 모듈이나 직접 구현한 네트워크 프레임워크를 통해 이 계층의 기능을 구현합니다.

각 계층의 역할을 이해하면 네트워크 문제 발생 시 원인을 파악하고 해결하는 데 큰 도움이 됩니다. 예를 들어, 데이터가 유실된다면 전송 계층(UDP 사용 시)이나 데이터 링크 계층(물리적 오류)을 의심해볼 수 있다.

## 게임 개발에서의 네트워크 문제 해결 흐름 예시

플레이어가 끊김(Lag)을 호소할 때, 네트워크 문제 해결은 다음과 같은 흐름으로 진행될 수 있습니다.

1.  **전송 계층 (Transport Layer) 확인**:
    -   **문제**: 패킷 손실, 지연, 순서 뒤바뀜.
    -   **점검**: 게임 클라이언트와 서버 간의 TCP/UDP 통신 로그를 분석하여 패킷 손실률, RTT(Round Trip Time) 지연 시간, 재전송 발생 여부 등을 확인합니다. UDP를 사용하는 경우, 자체적인 신뢰성 보장 메커니즘(예: ACK, 재전송)이 제대로 동작하는지 검토합니다.

2.  **네트워크 계층 (Network Layer) 분석**:
    -   **문제**: 잘못된 라우팅 경로, IP 주소 충돌, 네트워크 혼잡.
    -   **점검**: `traceroute` 또는 `pathping` 명령어를 사용하여 클라이언트에서 서버까지의 라우팅 경로를 분석하고, 특정 구간에서 지연이나 손실이 발생하는지 확인합니다. 서버 측에서는 방화벽 설정, 로드 밸런서의 동작, CDN(Content Delivery Network) 사용 여부 등을 검토하여 네트워크 경로상의 병목 현상을 파악합니다.

3.  **데이터 링크 계층 (Data Link Layer) 점검**:
    -   **문제**: MAC 주소 충돌, 스위치 포트 오류, 이더넷 케이블 불량, Wi-Fi 신호 간섭.
    -   **점검**: 클라이언트 측에서는 유선/무선 네트워크 연결 상태, 드라이버 문제 등을 확인하고, 서버 측에서는 네트워크 인터페이스 카드(NIC)의 상태, 스위치/라우터의 포트 상태 및 오류 카운터를 확인합니다. 특히 Wi-Fi 환경에서는 채널 간섭, 신호 강도 등을 점검합니다.

4.  **물리 계층 (Physical Layer) 확인**:
    -   **문제**: 케이블 단선, 커넥터 불량, 전자기 간섭, 하드웨어 고장.
    -   **점검**: 네트워크 케이블의 물리적 손상 여부, 커넥터의 연결 상태, 네트워크 장비(모뎀, 라우터, 스위치)의 전원 및 동작 상태를 육안으로 확인합니다. 무선 환경에서는 전파 방해 요소를 제거하고, 안테나 위치를 조정하는 등의 조치를 취합니다.

이러러한 다계층적인 접근을 통해 네트워크 문제의 근본 원인을 파악하고 효과적으로 해결할 수 있습니다.